
# 1. 서버 이중화의 과제
<br>

+ 브라우저에서 사용하는 HTTP는 무상태 프로토콜(Stateless Protocol)이어서 서버와 클라이언트 간의 통신을 유지할 수 없다.

    - 그래서 애플리케이션은 브라우저를 식별하기 위해 쿠키(Cookie)를 HTTP 프로토콜의 헤더에 포함시켜 전송한다.

    - 브라우저는 쿠키를 보관해 뒀더가 같은 URL에 접근할 때는 기억해 둔 쿠기를 HTTP 헤더에 기재항여 전송한다.
<br>

+ 웹 애플리케이션의 서버가 한 대만 있으면 괜찮지만 여러 대의 서버를 두고 그 앞에 로드밸런서를 두는 경우에는 또 다른 문제가 발생한다.

    - 로드밸런서가 세션 정보를 가지고 있지 않은 서버에 요청을 전달해 버리면, 올바른 처리를 수행할 수 없게 되기 때문이다.

    - 그러면 로그인을 했는데 다시 로그인 화면이 뜨는 일이 벌어질 것이다.
<br>

+ 이 문제를 해결하기 위한 기능으로 로드밸런서에는 세션 어피니티(=sticky session)가 있다.

    - 브라우저에서의 요청을 언제나 동일한 서버의 프로세스에 전달한다. (즉, 세션 정보를 가지고 있는 애플리케이션 프로세스에 전송해 주는 것이다.)
<br>

+ 한편, The Twelve Factor Apps에서는 세션 정보를 외부 캐시에 보관하는 것을 추천한다. 
    
    - 이에 따라 쿠버네티스도 세션 정보를 파드 외부의 캐시에 보관하는 것을 가정하고 있다.

    - 서비스 컨트롤러의 부하분산 기능을 요청을 파드들에게 랜덤하게 전송할 뿐이다.

    - 하지만 인그레스의 세션 어피니티 기능을 제공하며, 이를 통해 기존 웹 애플리케이션의 코드 수정을 최소화하면서 쿠버네티스를 사용할 수 있다.